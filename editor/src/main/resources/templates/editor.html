<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Online Judge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            height: 95vh;
        }
        
        .header {
            grid-column: 1 / -1;
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .problems-panel {
            grid-column: 1;
            background: #f8f9fa;
            padding: 20px;
            border-right: 1px solid #ddd;
            overflow-y: auto;
        }
        
        .editor-panel {
            grid-column: 2;
            display: flex;
            flex-direction: column;
        }
        
        .editor-container {
            flex: 1;
            border: 1px solid #ddd;
        }
        
        .controls {
            padding: 15px 20px;
            background: #f8f9fa;
            display: flex;
            gap: 10px;
            align-items: center;
            border-top: 1px solid #ddd;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-run {
            background: #28a745;
            color: white;
        }
        
        .btn-test {
            background: #007bff;
            color: white;
        }
        
        .btn-run:hover { background: #218838; }
        .btn-test:hover { background: #0056b3; }
        
        .output-section {
            grid-column: 1 / -1;
            height: 300px;
            display: flex;
            flex-direction: column;
        }
        
        .output-tabs {
            display: flex;
            background: #343a40;
        }
        
        .tab {
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            border: none;
            background: transparent;
        }
        
        .tab.active {
            background: #495057;
            border-bottom: 3px solid #007bff;
        }
        
        .output-container {
            flex: 1;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', monospace;
            padding: 15px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .problem-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .problem-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #007bff;
        }
        
        .problem-card.active {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .test-result {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .test-passed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-failed {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status {
            margin-left: auto;
            padding: 8px 12px;
            background: white;
            border-radius: 4px;
            font-size: 12px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Java Online Judge</h1>
            <p>–†–µ—à–∞–π—Ç–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –Ω–∞ Java</p>
        </div>
        
        <div class="problems-panel">
            <h3>üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</h3>
            <div id="problems-list"></div>
        </div>
        
        <div class="editor-panel">
            <div class="editor-container" id="editor"></div>
            <div class="controls">
                <button class="btn btn-run" onclick="runCode()">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                <button class="btn btn-test" onclick="testSolution()">üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                <div id="status" class="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ...</div>
            </div>
        </div>
        
        <div class="output-section">
            <div class="output-tabs">
                <button class="tab active" onclick="showTab('output')">–í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã</button>
                <button class="tab" onclick="showTab('tests')">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</button>
            </div>
            <div id="output" class="output-container">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</div>
            <div id="tests" class="output-container" style="display: none;"></div>
        </div>
    </div>

    <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
<script>
    let editor;
    let currentProblemId = 1;
    let currentActiveTab = 'output';
    
    require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor@0.45.0/min/vs' }});
    
    require(['vs/editor/editor.main'], function() {
        editor = monaco.editor.create(document.getElementById('editor'), {
            value: '// –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞\n// –ù–∞–ø–∏—à–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å"',
            language: 'java',
            theme: 'vs-dark',
            fontSize: 14,
            automaticLayout: true
        });
        
        loadProblems();
        updateStatus('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!', 'info');
    });
    
    async function loadProblems() {
        try {
            const response = await fetch('/problems');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const problems = await response.json();
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã –∑–∞–¥–∞—á–∏:', problems);
            
            const problemsList = document.getElementById('problems-list');
            problemsList.innerHTML = '';
            
            problems.forEach(problem => {
                const problemCard = document.createElement('div');
                problemCard.className = 'problem-card';
                problemCard.dataset.problemId = problem.id;
                problemCard.innerHTML = `
                    <h4>${problem.title}</h4>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">
                        ID: ${problem.id} ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                    </p>
                `;
                
                problemCard.addEventListener('click', function() {
                    loadProblem(problem.id);
                });
                
                problemsList.appendChild(problemCard);
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if (problems.length > 0) {
                await loadProblem(problems[0].id);
            }
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
            displayOutput('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á: ' + error.message);
            updateStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á', 'error');
        }
    }
    
    async function loadProblem(problemId) {
    	console.log('=== DEBUG LOADPROBLEM ===');
    	console.log('problemId:', problemId);
    	console.log('currentProblemId before:', currentProblemId);
        try {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á–∏ ID:', problemId);
            const response = await fetch('/problem/' + problemId);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const problem = await response.json();
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–∞–¥–∞—á–∞:', problem);
            
            currentProblemId = problemId;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É
            document.querySelectorAll('.problem-card').forEach(card => {
                card.classList.remove('active');
                if (parseInt(card.dataset.problemId) === problemId) {
                    card.classList.add('active');
                }
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–¥ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
            editor.setValue(problem.initialCode || '// –ö–æ–¥ –∑–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
            displayOutput(`üìñ –ó–∞–¥–∞—á–∞: ${problem.title}\n\n${problem.description}\n\nüí° –ù–∞–ø–∏—à–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å"`);
            
            updateStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–∞–¥–∞—á–∞: ${problem.title}`, 'success');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á–∏:', error);
            updateStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á–∏', 'error');
            displayOutput('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á–∏: ' + error.message);
        }
    }
    
    async function runCode() {
        const code = editor.getValue();
        if (!code.trim()) {
            displayOutput('‚ùå –ö–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!');
            return;
        }
        
        updateStatus('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...', 'info');
        displayOutput('‚è≥ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞...');
        
        try {
            const response = await fetch('/execute', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code: code })
            });
            
            const result = await response.json();
            
            if (result.success) {
                updateStatus('–£—Å–ø–µ—à–Ω–æ!', 'success');
                displayOutput('‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!\n\n' + (result.output || '–í—ã–≤–æ–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'));
            } else {
                updateStatus('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è', 'error');
                displayOutput('‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:\n' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
            }
            
        } catch (error) {
            updateStatus('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
            displayOutput('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
        }
    }
    
    async function testSolution() {
        const code = editor.getValue();
        if (!code.trim()) {
            displayTests('‚ùå –ö–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º!');
            return;
        }
        
        updateStatus('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'info');
        displayTests('üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...');
        
        try {
            const response = await fetch('/test', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    code: code, 
                    problemId: currentProblemId 
                })
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const result = await response.json();
            console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', result);
            
            let testsHtml = '';
            if (result.success) {
                testsHtml += `<div style="color: #28a745; margin-bottom: 15px;">
                    <h3>‚úÖ ${result.summary || '–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!'}</h3>
                </div>`;
            } else {
                testsHtml += `<div style="color: #dc3545; margin-bottom: 15px;">
                    <h3>‚ùå ${result.summary || '–¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã'}</h3>
                </div>`;
            }
            
            if (result.testResults && result.testResults.length > 0) {
                result.testResults.forEach((test, index) => {
                    testsHtml += `
                        <div class="test-result ${test.passed ? 'test-passed' : 'test-failed'}">
                            <strong>–¢–µ—Å—Ç ${index + 1}:</strong> ${test.passed ? '‚úÖ –ü—Ä–æ–π–¥–µ–Ω' : '‚ùå –ù–µ –ø—Ä–æ–π–¥–µ–Ω'}
                            ${!test.hidden || !test.passed ? `
                                <div style="margin-top: 5px; font-size: 12px;">
                                    <div>–í—Ö–æ–¥: <code>${test.input || 'N/A'}</code></div>
                                    <div>–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥: <code>${test.expectedOutput || 'N/A'}</code></div>
                                    <div>–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥: <code>${test.actualOutput || 'N/A'}</code></div>
                                </div>
                            ` : '<div style="margin-top: 5px;">–°–∫—Ä—ã—Ç—ã–π —Ç–µ—Å—Ç</div>'}
                        </div>
                    `;
                });
            } else {
                testsHtml += '<div style="color: #856404;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ—Å—Ç–∞—Ö</div>';
            }
            
            displayTests(testsHtml);
            updateStatus(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${result.passedTests || 0}/${result.totalTests || 0}`, 
                       result.success ? 'success' : 'error');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
            displayTests('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message);
            updateStatus('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
        }
    }
    
    function showTab(tabName) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
        document.querySelectorAll('.output-container').forEach(container => {
            container.style.display = 'none';
        });
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        const activeTab = document.querySelector(`.tab[onclick="showTab('${tabName}')"]`);
        if (activeTab) {
            activeTab.classList.add('active');
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        const activeContainer = document.getElementById(tabName);
        if (activeContainer) {
            activeContainer.style.display = 'block';
        }
        
        currentActiveTab = tabName;
    }
    
    function displayOutput(content) {
        const outputElement = document.getElementById('output');
        if (outputElement) {
            outputElement.textContent = content;
        }
        showTab('output');
    }
    
    function displayTests(content) {
        const testsElement = document.getElementById('tests');
        if (testsElement) {
            testsElement.innerHTML = content;
        }
        showTab('tests');
    }
    
    function updateStatus(message, type) {
        const status = document.getElementById('status');
        if (status) {
            status.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            status.style.background = type === 'error' ? '#f8d7da' : 
                                    type === 'success' ? '#d4edda' : '#d1ecf1';
            status.style.color = type === 'error' ? '#721c24' : 
                               type === 'success' ? '#155724' : '#0c5460';
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π
        showTab('output');
    });
</script>
</body>
</html>