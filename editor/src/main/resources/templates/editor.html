<!DOCTYPE html>
<html>
<head>
    <title>Java Editor & Judge</title>
    <style>
        /* –°—Ç–∏–ª–∏ –∏–∑ –æ–±–µ–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º */
        .container { display: flex; flex-direction: column; height: 100vh; padding: 20px; }
        .header { text-align: center; margin-bottom: 20px; }
        .main-content { display: flex; flex: 1; gap: 20px; }
        .problems-panel { width: 300px; background: #f5f5f5; padding: 15px; border-radius: 5px; }
        .editor-panel { flex: 1; display: flex; flex-direction: column; }
        .editor-container { flex: 1; border: 1px solid #ccc; border-radius: 5px; }
        .controls { display: flex; gap: 10px; align-items: center; margin: 10px 0; }
        .btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-run { background: #28a745; color: white; }
        .btn-test { background: #17a2b8; color: white; }
        .status { padding: 10px; border-radius: 5px; margin-left: auto; }
        .output-tabs { display: flex; margin-bottom: 10px; }
        .tab { padding: 10px 15px; border: 1px solid #ccc; background: #f8f9fa; cursor: pointer; }
        .tab.active { background: #007bff; color: white; }
        .output-container { 
            flex: 1; 
            border: 1px solid #ccc; 
            padding: 15px; 
            border-radius: 5px; 
            background: #f8f9fa; 
            white-space: pre-wrap;
            font-family: monospace;
        }
        .problem-card { 
            padding: 10px; 
            margin: 5px 0; 
            background: white; 
            border-radius: 3px; 
            cursor: pointer; 
        }
        .problem-card.active { background: #007bff; color: white; }
        .test-result { padding: 10px; margin: 5px 0; border-radius: 3px; }
        .test-passed { background: #d4edda; border: 1px solid #c3e6cb; }
        .test-failed { background: #f8d7da; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Java Editor & Judge</h1>
            <p>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ –∏ —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –æ–¥–Ω–æ–º!</p>
        </div>
        
        <div class="main-content">
            <div class="problems-panel">
                <h3>üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</h3>
                <div id="problems-list"></div>
            </div>
            
            <div class="editor-panel">
                <div class="editor-container" id="editor"></div>
                <div class="controls">
                    <button class="btn btn-run" onclick="runCode()">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                    <button class="btn btn-test" onclick="testSolution()">üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <div id="status" class="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ...</div>
                </div>
            </div>
        </div>

        <div class="output-section">
            <div class="output-tabs">
                <button class="tab active" onclick="showTab('output')">–í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã</button>
                <button class="tab" onclick="showTab('tests')">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</button>
            </div>
            <div id="output" class="output-container">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div id="tests" class="output-container" style="display: none;"></div>
        </div>
    </div>

    <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script>
        let editor;
        let currentProblemId = 1;
        
        require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor@0.45.0/min/vs' }});
        
     // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('editor'), {
                value: `import java.util.Scanner;\n\npublic class Solution {\n    public static void main(String[] args) {\n        Scanner scanner = new Scanner(System.in);\n        // –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–¥ –∑–¥–µ—Å—å\n        // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è - —Ä–µ—à–∞–π—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ!\n    }\n}`,
                language: 'java',
                theme: 'vs-dark',
                fontSize: 14,
                automaticLayout: true
            });
            
            loadProblems();
            updateStatus('–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞! –†–µ—à–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.', 'info');
        });

        
        
        async function loadProblems() {
            try {
                const response = await fetch('/problems');
                const problems = await response.json();
                
                const problemsList = document.getElementById('problems-list');
                problemsList.innerHTML = '';
                
                problems.forEach(problem => {
                    const problemCard = document.createElement('div');
                    problemCard.className = 'problem-card';
                    problemCard.dataset.problemId = problem.id;
                    problemCard.innerHTML = `<h4>${problem.title}</h4>`;
                    
                    problemCard.addEventListener('click', () => loadProblem(problem.id));
                    problemsList.appendChild(problemCard);
                });
                
                if (problems.length > 0) {
                    await loadProblem(problems[0].id);
                }
                
            } catch (error) {
                displayOutput('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á: ' + error.message);
            }
        }
        
       
        
        async function loadProblem(problemId) {
            try {
                const response = await fetch('/problem/' + problemId);
                const problem = await response.json();
                
                currentProblemId = problemId;
                
                document.querySelectorAll('.problem-card').forEach(card => {
                    card.classList.toggle('active', parseInt(card.dataset.problemId) === problemId);
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ß–ò–°–¢–´–ô —à–∞–±–ª–æ–Ω –±–µ–∑ —Ä–µ—à–µ–Ω–∏–π
                editor.setValue(`import java.util.Scanner;\n\npublic class Solution {\n    public static void main(String[] args) {\n        Scanner scanner = new Scanner(System.in);\n        // –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å\n    }\n}`);
                
                displayOutput(`üìñ –ó–∞–¥–∞—á–∞: ${problem.title}\n\n${problem.description}\n\nüí° –ü—Ä–∏–º–µ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏.`);
                
                updateStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–∞–¥–∞—á–∞: ${problem.title}`, 'success');
                
            } catch (error) {
                displayOutput('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á–∏: ' + error.message);
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        async function runCode() {
            const code = editor.getValue();
            updateStatus('–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã...', 'info');
            displayOutput('‚è≥ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ...');
            
            try {
                const response = await fetch('/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    updateStatus('–£—Å–ø–µ—à–Ω–æ!', 'success');
                    displayOutput(result.output);
                } else {
                    updateStatus('–û—à–∏–±–∫–∞', 'error');
                    displayOutput(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
                
            } catch (error) {
                updateStatus('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
                displayOutput('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –†–ï–ñ–ò–ú 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—á–∏—Å—Ç—ã–π –≤—ã–≤–æ–¥ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è)
        async function testSolution() {
            const code = editor.getValue();
            updateStatus('–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...', 'info');
            
            try {
                const response = await fetch('/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        code: code, 
                        problemId: currentProblemId 
                    })
                });
                
                const result = await response.json();
                
                let testsHtml = '';
                if (result.success) {
                    testsHtml += `<div style="color: #28a745; margin-bottom: 15px;">
                        <h3>‚úÖ ${result.summary}</h3>
                    </div>`;
                } else {
                    testsHtml += `<div style="color: #dc3545; margin-bottom: 15px;">
                        <h3>‚ùå ${result.summary}</h3>
                    </div>`;
                }
                
                result.testResults.forEach((test, index) => {
                    testsHtml += `
                        <div class="test-result ${test.passed ? 'test-passed' : 'test-failed'}">
                            <strong>–¢–µ—Å—Ç ${index + 1}:</strong> ${test.passed ? '‚úÖ –ü—Ä–æ–π–¥–µ–Ω' : '‚ùå –ù–µ –ø—Ä–æ–π–¥–µ–Ω'}
                            ${!test.hidden || !test.passed ? `
                                <div style="margin-top: 5px; font-size: 12px;">
                                    <div>–í—Ö–æ–¥: <code>${test.input}</code></div>
                                    <div>–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥: <code>${test.expectedOutput}</code></div>
                                    <div>–ü–æ–ª—É—á–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥: <code>${test.actualOutput}</code></div>
                                </div>
                            ` : '<div>–°–∫—Ä—ã—Ç—ã–π —Ç–µ—Å—Ç</div>'}
                        </div>
                    `;
                });
                
                displayTests(testsHtml);
                updateStatus(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${result.passedTests}/${result.totalTests}`, 
                           result.success ? 'success' : 'error');
                
            } catch (error) {
                updateStatus('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                displayTests('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message);
            }
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.output-container').forEach(container => {
                container.style.display = 'none';
            });
            
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).style.display = 'block';
        }
        
        function displayOutput(content) {
            document.getElementById('output').textContent = content;
            showTab('output');
        }
        
        function displayTests(content) {
            document.getElementById('tests').innerHTML = content;
            showTab('tests');
        }
        
        function updateStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            status.style.background = type === 'error' ? '#f8d7da' : 
                                    type === 'success' ? '#d4edda' : '#d1ecf1';
            status.style.color = type === 'error' ? '#721c24' : 
                               type === 'success' ? '#155724' : '#0c5460';
        }
    </script>
</body>
</html>